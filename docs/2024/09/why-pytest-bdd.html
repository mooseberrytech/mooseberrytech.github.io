<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Why pytest-bdd?</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="/2024/09/why-pytest-bdd.html" rel="canonical" />
  <!-- Feed -->

  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="Introduction This blog posts doesn't advocate for BDD testing. If you are already convinced that you need some BDD tests as part of your...">

    <meta name="author" content="Adriana">





<!-- Open Graph -->
<meta property="og:site_name" content=""/>
<meta property="og:title" content="Why pytest-bdd?"/>
<meta property="og:description" content="Introduction This blog posts doesn't advocate for BDD testing. If you are already convinced that you need some BDD tests as part of your..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/2024/09/why-pytest-bdd.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2024-09-12 00:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/adriana">
<meta property="article:section" content="misc"/>
<meta property="og:image" content="/theme/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Why pytest-bdd?",
  "headline": "Why pytest-bdd?",
  "datePublished": "2024-09-12 00:00:00+01:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Adriana",
    "url": "/author/adriana"
  },
  "image": "/theme/images/post-bg.jpg",
  "url": "/2024/09/why-pytest-bdd.html",
  "description": "Introduction This blog posts doesn't advocate for BDD testing. If you are already convinced that you need some BDD tests as part of your..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>

              <li role="presentation"><a href="/pages/about-mooseberry-tech-blog/">About Mooseberry Tech Blog</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Why pytest-bdd?</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="/author/adriana">Adriana Vasiu</a>
            | <time datetime="Thu 12 September 2024">Thu 12 September 2024</time>
        </span>
        <!-- TODO : Modified check -->
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <h3>Introduction</h3>
<p>This blog posts doesn't advocate for BDD testing. If you are already convinced that you need some BDD tests as part of your software development lifecycle and you have been looking around for what frameworks to choose, than this post might be useful for you.</p>
<h3>Why use pytest-bdd?</h3>
<p>I have used a lot of BDD frameworks in the past. The ones that I remember are Lettuce, Freshen and Behave. All of them worked ok. They did the job. 
Behave for example, is very feature reach, it offers features like data tables which is particularly useful for building data driven tests. All that worked well.</p>
<p>But each of those frameworks came in short in some aspects. I am not going to focus on a feature by feature comparison on all these frameworks. 
Instead, I am going to share what I would like to see in a testing framework and how <a href="https://pytest-bdd.readthedocs.io/en/stable/">pytest-bdd</a> measures against that. </p>
<p>Here are the main aspects that are important to me:
- it is simple
- it is easy to run
- encourages explicit behaviour rather than implicit
- has an active support community
- comes with good documentation
- supports running scenarios in parallel
Let's address each of the points above and see why pytest-bdd measures against them.</p>
<h3>Simple</h3>
<p>What does it take to set up the framework?
Step 1. Install the package. (Let's assume you are using poetry.)</p>
<div class="highlight"><pre><span></span><code>poetry add pytest-bdd
</code></pre></div>

<p>Step 2. Create your test structure.</p>
<div class="highlight"><pre><span></span><code>tests
   features
      demo.feature
   __init__.py
   test_demo.py
</code></pre></div>

<p>Step 3. Create a test feature with one scenario.</p>
<div class="highlight"><pre><span></span><code><span class="n">Feature</span><span class="o">:</span>
<span class="w">  </span><span class="n">Scenario</span><span class="o">:</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">demo</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">blog</span>
<span class="w">    </span><span class="n">Given</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">posts</span>
<span class="w">    </span><span class="n">When</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">publish</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">post</span>
<span class="w">    </span><span class="n">Then</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">posts</span>
</code></pre></div>

<p>^^ <code>demo.feature</code>
Step 4. Create the test that runs the feature and implement the scenario steps.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_bdd</span> <span class="kn">import</span> <span class="n">scenarios</span><span class="p">,</span> <span class="n">given</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">then</span><span class="p">,</span> <span class="n">parsers</span>

<span class="n">scenarios</span><span class="p">(</span><span class="s2">&quot;features/demo.feature&quot;</span><span class="p">)</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">parsers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;I have a blog with </span><span class="si">{number_of_posts}</span><span class="s2"> posts&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">given_blog</span><span class="p">(</span><span class="n">number_of_posts</span><span class="p">):</span>
    <span class="o">...</span>


<span class="nd">@when</span><span class="p">(</span><span class="s2">&quot;I publish a new post&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">when_publish</span><span class="p">():</span>
    <span class="o">...</span>


<span class="nd">@then</span><span class="p">(</span><span class="n">parsers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;my blog will contain </span><span class="si">{number_of_posts}</span><span class="s2"> posts&quot;</span><span class="p">))</span>
<span class="nd">@then</span><span class="p">(</span><span class="n">parsers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;my blog will contain </span><span class="si">{number_of_posts}</span><span class="s2"> post&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">check_blog_posts</span><span class="p">(</span><span class="n">number_of_posts</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>

<p>^^ <code>test_demo.py</code></p>
<p>This is it! You have everything you need to start implementing your first test.</p>
<h3>Easy to run</h3>
<p>Tests written with <code>pytest-bdd</code> take advantage of the <code>pytest</code> runner, and the autodiscovery of tests that it provides.
Run your test with <code>pytest</code> (This assumes <code>pytest-bdd</code> was installed with poetry.):
<code>poetry run pytest</code>
This will automatically find all files named with the prefix <code>test_</code> in the <code>tests</code> directory.</p>
<h3>Explicit behaviour rather than explicit</h3>
<p>I like that pytest makes the state management of your steps obvious and explicit.
There is no context object that is passed implicitly in every step, <code>pytest-bdd</code> makes use of <a href="https://docs.pytest.org/en/6.2.x/fixture.html">fixtures</a>
to manage state and fixtures are explicit, modular and scalable.
Here is an example of a fixture passed from one step into the next.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Blog</span><span class="p">:</span>
    <span class="n">posts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">blog</span><span class="p">():</span>
    <span class="o">...</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">parsers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;I have a blog with </span><span class="si">{number_of_posts}</span><span class="s2"> posts&quot;</span><span class="p">),</span> <span class="n">target_fixture</span><span class="o">=</span><span class="s2">&quot;blog&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">given_blog</span><span class="p">(</span><span class="n">number_of_posts</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Blog</span><span class="p">(</span><span class="n">posts</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">number_of_posts</span><span class="p">))</span>


<span class="nd">@when</span><span class="p">(</span><span class="s2">&quot;I publish a new post&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">when_publish</span><span class="p">(</span><span class="n">blog</span><span class="p">):</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">posts</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="nd">@then</span><span class="p">(</span><span class="n">parsers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;my blog will contain </span><span class="si">{number_of_posts}</span><span class="s2"> posts&quot;</span><span class="p">))</span>
<span class="nd">@then</span><span class="p">(</span><span class="n">parsers</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;my blog will contain </span><span class="si">{number_of_posts}</span><span class="s2"> post&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">check_blog_posts</span><span class="p">(</span><span class="n">number_of_posts</span><span class="p">,</span> <span class="n">blog</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">blog</span><span class="o">.</span><span class="n">posts</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_of_posts</span><span class="p">)</span>
</code></pre></div>

<p>^^ <code>test_demo.py</code>
The fixture <code>blog</code> is overriden in the <code>given_blog</code> step, then passed into the next <code>when_publish</code> step and re-used 
in the <code>check_blog_posts</code> step for verification.
The state is defined explicitly, you know which fixture you are targeting or modifying.</p>
<h2>Community and Documentation</h2>
<p>The <a href="https://github.com/pytest-dev/pytest-bdd">pytest-bdd</a> codebase and documentation are frequently updated. 
There are quite a few issues logged and discussed, and sometimes workarounds are proposed. 
There are also a lot of video and written tutorials published online or how to use the framework.</p>
<h2>Supports Running Scenarios in parallel</h2>
<p><code>pytest-bdd</code> integrates with <a href="https://pytest-xdist.readthedocs.io/en/stable/">pytest-xdist</a>.
Install <code>pytest-dist</code> (Let's assume you are using poetry.):</p>
<div class="highlight"><pre><span></span><code>poetry add pytest-xdist
</code></pre></div>

<p>If you want to distribute tests across multiple CPUs in order to optimise test execution, run multiple worker processes:</p>
<div class="highlight"><pre><span></span><code>poetry run pytest -n auto
</code></pre></div>

<h2>Summary</h2>
<p>If you are looking for a BDD framework that you want to start using in minutes and especially if you are 
already using the feature rich <code>pytest</code> framework, give <code>pytest-bdd</code> a try. 
It's the framework that will allow you to write steps in the most python way and allows you to run all your tests with one command.</p>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Why pytest-bdd?&amp;url=/2024/09/why-pytest-bdd.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/2024/09/why-pytest-bdd.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=/2024/09/why-pytest-bdd.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>


                <div class="clear"></div>

                <aside class="post-author">


                        <figure class="post-author-avatar">
                            <img src="/images/mooseberry_tech-512x512-NO-TEXT.png" alt="Adriana Vasiu" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="/author/adriana">Adriana Vasiu</a></h4>
                            <p class="post-author-about">I currently work as a consultant on software development.</p>
                            <span class="post-author-location"><i class="ic ic-location"></i> London</span>
                        <!-- Social linkes in alphabet order. -->
                            <span class="post-author-linkedin"><a target="_blank" href="https://www.linkedin.com/in/unavailable"><i class="ic ic-link"></i> LinkedIn</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/theme/js/script.js"></script>

</body>
</html>